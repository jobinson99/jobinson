<!DOCTYPE html>
<html>

    <head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>利用github建静态站手记——黑传说版</title>
<meta name="description" content="黑传说的学习笔记">

<link rel="canonical" href="http://jobinson.ga/%E5%BB%BA%E7%AB%99%E4%B9%8B%E8%B7%AF/2014/04/23/%E9%BB%91%E4%BC%A0%E8%AF%B4%E4%B9%8B%E5%88%A9%E7%94%A8github%E5%BB%BA%E9%9D%99%E6%80%81%E7%AB%99%E6%89%8B%E8%AE%B0/">

<!-- 皮肤样式 -->
<link rel="stylesheet" href="/themes/atlas/css/style.css">

<!-- 首页和404各站特异的样式 -->
<link rel="stylesheet" href="/static/main.css">

<link rel="icon" type="image/x-icon" href="/favicon.ico">

</head>
    
  <body>

      <div class="left-top-hook"></div><!-- 站内信息 -->
<div class="right-top-hook"></div><!-- 页内信息 -->
<div class="left-middle-hook"></div><!-- 页内操作 -->
<div class="right-middle-hook"></div><!-- 页内导航 -->
<div class="right-bottom-hook"></div><!-- 站内系统 -->
<div class="left-bottom-hook"></div><!-- 站内栏目 -->

<header class="site-header">  
  <nav class="site-nav">
    <ul>
      <li><a href="/">外立面</a></li>
      <li><a href="/分类列表/">按分类查看</a></li>
      <li><a href="/话题列表/">按话题查看</a></li>
      <li><a href="/时间列表/">按时间查看</a></li>
      <li><a href="/友情链接/">好友关系</a></li>
      <li><a href="/关于我/">关于我</a></li>
    </ul>
  </nav>
  
</header>  

<nav class="outline toc">
</nav> 

      
      <div class="post">
  
  <header class="post-header">
    <h1 id="利用github建静态站手记——黑传说版">利用github建静态站手记——黑传说版</h1>

    <div class="post-abstract">
      
      <p><b>摘要：</b><br/>利用github pages，建造静态站点的手记</p>
      

      
      <p class="post-tag"><b>话题：</b>
        
        <a href="/话题列表/#建站-ref">建站
        <sup>1</sup></a>
        &nbsp;
        
        <a href="/话题列表/#github-ref">github
        <sup>2</sup></a>
        &nbsp;
        
        <a href="/话题列表/#静态站-ref">静态站
        <sup>4</sup></a>
        &nbsp;
        
        <a href="/话题列表/#双库法-ref">双库法
        <sup>1</sup></a>
        &nbsp;
        
        <a href="/话题列表/#域名-ref">域名
        <sup>1</sup></a>
        &nbsp;
        
      </p>
      
      
    </div>

    <p class="meta">
      
      <span class="post-categories">类别：
        
        <a href="/分类列表/#建站之路-ref">建站之路</a>
        
      </span>
      
      
      创建时间：2014-04-23 17:45:26
      
      
    </p>
    
  </header>

  <article class="post-content">
    <h2 id="github">github建立日志系统的优势</h2>

<blockquote>
  <p>喜欢分享日志的人，会经历三个阶段：</p>

  <p>第一阶段，刚接触日志分享系统，觉得很新鲜，试着选择一个免费的日志分享托管网站来写。</p>

  <p>第二阶段，觉得免费的博客托管网站限制太多，就自己买域名和空间，自己搭独立日志系统。</p>

  <p>第三阶段，觉得独立日志系统的日常管理太繁琐，最好在保留控制权的前提下，让别人来管，自己只负责写日志。</p>

  <p>大多数日志作者，都徘徊在第一和第二阶段，因为第三阶段不太容易到达：你很难找到俯首听命、愿意为你管理服务器的人。</p>

  <p>但是不久前，情况出现变化，一些程序员利用github搭建日志系统。他们既拥有绝对管理权，又享受github带来的便利：</p>

  <p>只要向主机同步提案，即可发布新文章。更妙的是，还是免费的，github提供无限流量，世界各地都有理想的访问速度，不用自己去和服务器机房打交道了。</p>
</blockquote>

<p>github pages建网站可以说是其他技术类日志分享服务的克星，因为程序员愿意折腾。其好处：</p>

<ol>
  <li>可随意定制</li>
  <li>方便，和程序开发库（github）直通</li>
  <li>可控</li>
  <li>简单自动：只需要提交</li>
  <li>高效通用：markdown控制</li>
  <li>免费，无限流量，无限空间</li>
</ol>

<p>局限：</p>

<ol>
  <li>不提供 用户端-服务端 交互</li>
  <li>国内访问速度不可保障，可能被墙？</li>
</ol>

<h2 id="github-pages">启用 github pages：</h2>

<p>github提供两种类型的静态网站服务，</p>

<ul>
  <li>用户或者组织级的，域名是 <em>用户或组织名.github.io</em> 。启用方式：建立一个叫 <em>和用户或组织同名.github.io</em> 的仓库，github会自动把xxx.github.io仓库里的文件，转为github page的页面。</li>
  <li>项目级的，域名是 <em>用户或组织名.github.io/项目名</em> 。启用方式：建立一个名叫 <em>gh-pages</em> 的分支，github会自动把 gh-pages 仓库里的文件，转为github page的页面。</li>
</ul>

<p>由于 <em>xxx.github.io</em> 只能一个用户或者组织一个，需要新建一用户或者组织，很不方便，更常用的是项目级的，每个项目生成一个静态站，这样一个用户下可以有多个静态站，方便。</p>

<h2 id="section">使用：</h2>

<ul>
  <li>如果想让github来生成，则把需要的日志纳入成果管理，立案后，把本地的仓库同步到注册的github仓库的master分支中，然后静待github来生成——一般很快就完成了。</li>
  <li>如果不想让github来生成的话，则本地生成好，然后<strong>发布到github仓库的gh-pages分支</strong>，即完成发布。</li>
</ul>

<h2 id="section-1">如何使用自己想要静态站生成器和插件？</h2>

<p>几乎每种编程语言，都有若干生成静态网站的工具，可根据自己的需要和熟悉程度选用。</p>

<p>比如python的pelican，emacs的org-page，js的metalsmith等……</p>

<p>目前流行度最高的有ruby的jekyll。github就只使用了jekyll作为后台生成器，因此，如果用的是其他静态站生成器，都需要自己本地生成，然后发布到gh-pages分支。</p>

<p>jekyll使用方法见下一篇：<a href="/建站之路/2014/04/27/使用jekyll生成静态站/">使用jekyll生成静态站</a></p>

<p>注意：自己生成的话，需要在生成页面的根目录下，放一个 <em>.nojekyll</em> 文件关闭github的jekyll生成服务。</p>

<h2 id="section-2">如何维护双库？</h2>

<p>如果是用的其他静态站生成器，很明显，源码和生成的静态文件就分开了。</p>

<p>那么，如何管理呢？双库法！ <strong>生成后的静态站 仓库 只需要更新到远程的 gh-pages分支。</strong></p>

<p>默认的项目仓库情况：</p>

<table>
  <thead>
    <tr>
      <th>本地仓库</th>
      <th>本地地址</th>
      <th>远程对应的仓库</th>
      <th>作用</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>master</td>
      <td>xxx</td>
      <td>site/origin/master</td>
      <td>网站源码，主分支</td>
    </tr>
    <tr>
      <td>gh-pages</td>
      <td>xxx/_site</td>
      <td>site/origin/gh-pages</td>
      <td>分支，gh-pages只追踪和发布此文件夹下文件。</td>
    </tr>
  </tbody>
</table>

<p>说明：如果使用github的jekyll服务，则默认本地不需要gh-pages分支，只需要发布到远程，并新建一个gh-pages的分支即可。</p>

<p>双库法后，项目仓库如下：</p>

<table>
  <thead>
    <tr>
      <th>本地仓库</th>
      <th>本地实际地址</th>
      <th>远程对应的仓库</th>
      <th>作用</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>source/master</td>
      <td>xxx</td>
      <td>source/origin/master</td>
      <td>网站源码，主分支</td>
    </tr>
    <tr>
      <td>site/gh-pages</td>
      <td>xxx/_site</td>
      <td>site/origin/gh-pages</td>
      <td>分支或子模块</td>
    </tr>
  </tbody>
</table>

<p>说明：至少需要两个远程仓库，比如我用了bitbucket的私有库来保存源码，用github的 gh-pages 来保存生成的静态站。</p>

<p>文件结构如下：</p>

<pre><code>~/
  |-- xxx-source/       此处文件会发布到source/origin/master
  |    |-- _includes/
  |    |-- _posts/
  |    |-- index.html
  |    |-- .nojekyll
  |    |-- _config.yml
  |     ....
  |    |-- _site/ &lt;--- 软链或子模块，此处文件会发布到site/origin/gh-pages
  |
  |-- xxx-gh-pages/  ---&gt; 软链或子模块到 xxx-source/_site
</code></pre>

<p>从头开始的完整步骤：</p>

<ol>
  <li>远程开双仓库</li>
  <li>本地新建一文件夹 xxx-source，放入源码，然后同步到远程 <em>git@github.com:username/source.git</em></li>
  <li>本地新建一文件夹 xxx-gh-pages，软链到xxx-source/_site，然后同步到远程 <em>git@github.com:username/xxx-gh-pages.git</em></li>
  <li>每次xxx-source生成后，切换到 xxx-gh-pages 同步到远程xxx-gh-pages的gh-pages分支</li>
</ol>

<h3 id="section-3">双仓库的准备工作</h3>

<p>第一步，远程开双仓库。假设为如下：</p>

<ul>
  <li>git@github.com:username/source.git 本地的 xxx-source 会发布到此</li>
  <li>git@github.com:username/site.git 本地的 xxx-gh-pages 会发布到此</li>
</ul>

<p>第二步，关闭github服务器的jekyll编译器。</p>

<p>原理：在上传到gh-pages分支上的文件根目录下，创建一个名为 <em>.nojekyll</em> 的文件，即可关闭github的jekyll编译器。</p>

<p>方法：修改 <em>_config.yml</em>，加入如下两行，让其生成的文件中，带 <em>.nojekyll</em>文件：（后面有需要，还可以加入更多的，此处先加这个最基本的）</p>

<pre><code>include:
- .nojekyll
</code></pre>

<h4 id="section-4">一些有关操作</h4>

<p>远程删除或者添加分支</p>

<pre><code># 删除远程分支
git push origin :gh-pages
# 添加远程分支
git push origin gh-pages
</code></pre>

<p>生成孤立分支：先克隆源码站，然后生成孤立分支 gh-pages （带参数 <code>--orphan</code> 没有历史记录，是一个完全独立背景干净的分支），如有需要，可清空里面所有内容</p>

<pre><code>git clone git@github.com:username/site.git
cd repository

git checkout --orphan gh-pages

git rm -rf .
</code></pre>

<p>加入独有内容后，推送到服务器</p>

<pre><code>git push origin gh-pages
</code></pre>

<p><code>.htacess</code>呢？ 不行！
redirects呢？</p>

<p>问题：如何在同一目录，但互相监控不同的文件夹？同一目录双库？</p>

<p>先本地建完主分支master，然后新建小分支gh-pages</p>

<pre><code>git branch gh-pages
git push -u origin --all
</code></pre>

<p>一起推向服务器端</p>

<p>然后切换到分支gh-pages。把.git文件全部放入<code>_site</code>中，然后转到<code>_site</code>中，提交。</p>

<pre><code>git branch gh-pages
git push -u origin --all

git remote add origin ssh://git@github.com/username/site.git
git push -u origin master
git checkout gh-pages
git push -u origin gh-pages
</code></pre>

<p>可选步骤：删掉主分支，以免混淆。</p>

<pre><code>git branch -d master
git branch
</code></pre>

<h3 id="section-5">软链双库法</h3>

<p>前提：操作系统是linux，因为需要利用到一个linux才有的特性：软链</p>

<p>其中，<em>_site</em> 文件夹是个软链，本地生成的文件实际是放到硬盘另一个地方，生成后再转入此文件夹，把文件上传到github的origin/gh-pages。</p>

<p>下面不用软链时的操作（由于此法通用于windows下，所以此处也提供出来）： /xxx-source 和 /xxx-gh-pages</p>

<pre><code># 新建文件夹 xxx-gh-pages
mkdir xxx-gh-pages
cd xxx-gh-pages
git clone git@github.com:username/site.git
</code></pre>

<p>接下来，再在 xxx-gh-pages下面，添加 <code>.gitignore</code> 文件， 把一些不要监控的文件添加进去。</p>

<p>发布：</p>

<pre><code>cd ~/xxx-source
# 此处是把源码发布到源码仓库
git add .
git commit -am "发表文章"
git push
# 生成
jekyll build
cd ~/xxx-source/_site/
cp _site/* ~/xxx-gh-pages
cd ~/xxx-gh-pages
git add .
git commit "发表文章"
git push
</code></pre>

<p>浓缩为：（此处省去源码也发布部分，多个shell命令可以用 <code>;</code>或者 <code>&amp;&amp;</code> 连接起来）</p>

<pre><code>alias build_blog="cd ~/xxx-source; jekyll;cp -r ~/xxx-source/_site/* ~/xxx-gh-pages;cd ~/xxx-gh-pages;git add .;git commit -am '发表文章';git push"
alias bb="build_blog"
</code></pre>

<p>总要去复制文件，还不够省俭，如果是linux下，则可以更省俭：使用软链！</p>

<p>把xxx-gh-pages软链到~/xxx-source/_site：</p>

<pre><code># 软链到xxx-source/_site
cd ..
cd xxx-source
ln -s ~/xxx-gh-pages _site
</code></pre>

<p>最后批处理之：</p>

<pre><code>alias build_blog="cd ~/xxx-source; jekyll;cd ~/xxx-gh-pages;git add .;git commit -am '发表文章';git push"
alias bb="build_blog"
</code></pre>

<p><a href="http://charliepark.org/jekyll-with-plugins/">参考此文</a> </p>

<h2 id="submodules">子模块双库法：submodules</h2>

<p>全过程：</p>

<p>注意：为减少过程所需时间，在完成新建子模块前，尽可能在两个分支里面保留最少的文件，以减少新建子模块时间。</p>

<ol>
  <li>开两仓库。</li>
  <li>清空 <em>xxx-gh-pages</em> 的内容，并且提交到远程。清空的目的是减少克隆和提交时间。</li>
  <li>切换到 <em>xxx-source</em> 分支，把 <em>xxx-source</em> 分支也同步到github。</li>
  <li>接着，把xxx-gh-pages指为子模块，并挂载到 <code>_site</code>目录下。</li>
</ol>

<p>注意，此处不要有 <code>_site</code> 文件，下面的命令会自动克隆原有 <em>site</em> 到此处。</p>

<pre><code>$ git checkout master
$ git push -u origin --all

$ git submodule add -b master git@github.com:username/site.git _site
</code></pre>

<p>在 <em>xxx-source</em> 分支，看看情况：</p>

<pre><code>$ git status
要提交的变更：
  （使用 "git reset HEAD &lt;file&gt;..." 撤出暂存区）

        new file:   .gitmodules
        new file:   _site
</code></pre>

<p>接着输入下面命令，提案并同步github上的source仓库：</p>

<pre><code>$ git commit -m "把xxx-gh-pages变成xxx-source的子模块"
$ git push
</code></pre>

<p>初始化子模块，并看看其指向哪？</p>

<pre><code>$ git submodule init
Submodule '_site' (git@github.com:username/site.git) registered for path '_site'
$ git submodule 
4aac2028817a9de3e31f2c1b84f5783b9d837150 _site (heads/master)
</code></pre>

<p>接着，把还没被jekyll生成的源文件都搬到source的目录下，并全部纳入追踪名单。</p>

<pre><code>$ git add .
$ git commit -m "全部纳入追踪名单"
</code></pre>

<p>修改 <em>_config.yml</em>，让其生成的文件中，带 <em>.nojekyll</em>文件。</p>

<pre><code>include:
- .nojekyll
</code></pre>

<p>用jekyll生成网站，</p>

<pre><code>$ jekyll build
$ git status
</code></pre>

<p>移动到 <em>_site</em> 目录下，此时，会发现，已经不是在source仓库了，而是自动到了site仓库，看下分支情况：</p>

<pre><code>$ cd _site
$ git status
</code></pre>

<p>把 <em>_site</em> 下文件全部纳入管理，提交，同步到github的site仓库</p>

<pre><code>$ git add .
$ git commit -m "首次生成"
$ git push origin master
</code></pre>

<p>移动到source目录，提交更改，同步到于github的source仓库</p>

<pre><code>$ cd ..
$ git commit -a -m "建站完毕"
$ git push origin source
</code></pre>

<p>到此步已经完成，可以上github的网站看看结果。</p>

<p>总结：以后，整个发布流程变成了：</p>

<ol>
  <li>修改文件</li>
  <li>运行 jekyll 生成</li>
  <li>看下生成结果： _site</li>
  <li>子目录 <code>_site</code>下： add, commit and push changes</li>
  <li>源码目录，包括<code>_site</code>：  add, commit and push changes</li>
  <li>不断重复这个过程</li>
</ol>

<p>变为一命令：</p>

<pre><code>jekyll build &amp;&amp; cd _site &amp;&amp; git add ./ &amp;&amp; git commit -m '发布' &amp;&amp; git push origin master
</code></pre>

<p>可以写成一个批处理文件</p>

<pre><code>#!/bin/bash
set -e
message=$1

jekyll build
cd _site
git add ./
git commit -m '$message'
git push origin master
</code></pre>

<ul>
  <li><a href="http://blog.blindgaenger.net/generate_github_pages_in_a_submodule.html">参考此文</a></li>
  <li><a href="http://indelible.io/blog/2013/07/14/jekyll-plugins-and-github-pages.html">再参考此文</a> </li>
  <li><a href="http://dannpu.com/blog/2013/08/03/Github-page-build-failure/">利用本地编译结果替代github自动编译：淡朴若水</a></li>
</ul>

<h2 id="section-6">域名指向：使用其他域名</h2>

<p>Github Pages会为站点分配类似 <em>用户名或组织名.github.io</em> 或者 <em>用户名或组织名.github.io/项目名</em> 的二级/三级域名。</p>

<p>不够简洁，还是申请顶级域名吧。</p>

<p>申请域名：免费的域名(.tk)可以<a href="http://my.dot.tk/cgi-bin/amb/landing.dottk?nr=806151::15401173::1">在此申请</a>。
<em>.tk</em> 是南太平洋岛国托克劳的国家域名，支持域名转发（可隐藏原URL）、电邮转发、A记录解析、CNAME别名记录、MX邮件记录、设置DNS服务器等服务。</p>

<p>收费的域名到处有，自己去买吧。</p>

<h2 id="section-7">域名解析服务</h2>

<p>一般来说域名提供商会提供简单的解析服务，也支持将解析服务指向到其他域名解析服务提供者。</p>

<p>国外的如Godaddy，可能被墙。
国内的如DNSPod，有免费版。</p>

<p>配置：</p>

<ol>
  <li>在github站点中增加CNAME文件，里面第一行写上要使用的域名（注：只能一个）</li>
  <li>配置域名解析指向，分两种情况：
    <ul>
      <li>如果用的顶级域名，在域名解析服务提供商那里将A记录指向github提供的ip地址</li>
      <li>如果使用二级域名，在域名解析服务提供商那里增加CNAME记录，指向github提供的ip地址</li>
    </ul>
  </li>
</ol>

<p>使 www.域名 生效，需要咋办？</p>

<h2 id="section-8">博客搬家</h2>

<p>可能需要两步：</p>

<ol>
  <li>（如果博客已经是wordpress则跳过此步）第一步使用blogstowordpress导入任意博客为wordpress类型</li>
  <li>第二步则是利用jekyll-import导入到jekyll，或者利用exitwp导出为markdown。</li>
</ol>

<p>Jekyll提供了一个插件 jekyll-import(需要安装），可以将wordpress的博客导入到Jekyll。</p>

<pre><code>~ $ gem install jekyll jekyll-import
~ $ jekyll new my-awesome-site
~ $ cd my-awesome-site
~/my-awesome-site $ jekyll import wordpressdotcom --source wordpress.xml
~/my-awesome-site $ jekyll serve
# =&gt; 浏览器上察看结果 http://localhost:4000
</code></pre>

<p>exitwp是一个用python开发的工具，号称是将wordpress的博客导出并转换成markdown，但实际上 任何能导出rss/atom的博客都可以用这个工具进行转换。</p>

<pre><code>git clone https://github.com/thomasf/exitwp
sudo pip install --upgrade  -r pip_requirements.txt
cd exitwp/wordpress-xml/
wget http://your/atom/file/xml
cd ..
python exitwp.py
</code></pre>


  </article>

  <!-- 文章页面尾部设定 -->
<div class="post-end">

  <!-- 有言评论 -->
  <div id="uyan_frame"></div>
  <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1921243"></script>
  
  <!-- 结束有言评论 -->

  <div class="post-shift">


    <!--上一篇 话题 下一篇-->
    
    <div class="post-pre">
      <a class="pull-right" href="/%E7%A5%A5%E5%92%8C%E7%94%9F%E6%B4%BB/2014/04/20/%E5%AE%B6%E5%BA%AD%E8%87%AA%E9%85%BF%E6%9E%9C%E9%85%92/">◁前<br>【整理】家庭自酿果酒◀篇</a>
    </div>
    
    
     <!--回到头部-->
    <div class="back-top"><a href="#利用github建静态站手记——黑传说版">△
    <br>回头▲再看</a></div> 
    
    
    <div class="post-next">
    <a href="/%E5%BB%BA%E7%AB%99%E4%B9%8B%E8%B7%AF/2014/04/27/%E4%BD%BF%E7%94%A8jekyll%E7%94%9F%E6%88%90%E9%9D%99%E6%80%81%E7%AB%99/">后▷<br>篇▶使用jekyll生成静态站点</a>
    </div>
    
    
  </div>

<!--页面底部自动浮现-->
  <div class="post-reletive">
  <!--相关文章-->

  </div>


</div>



  <footer class="site-footer">
  <ul>
    <li>
      <span>©2015版权所有：黑传说</span>
      <span>欢迎转载，请注明出处并保留原文链接，谢谢合作！</span>
    </li>
    <li>
    <span>黑传说——乌抵天明</span>
    <span>玄鸟负日，光明万丈</span>
    </li>    
    <li>
    <span><a href="mailto:gmail for jobinson99">gmail for jobinson99</a></span>
    <span><a href="/feed.xml">戳此处关注我</a></span>
    <span><a href="https://github.com/jobinson99">我的开发仓库</a></span>
    </li>    
    <li>
      <span>致谢： </br>
        <a href="http://www.github.com">空间：github</a>，
        <a href="http://jekyllrb.com">构建：jekyll</a>，
        <a href="http://freenom.com/">域名：freenom</a>，
        以及一切对本人有帮助的人事物！</span>
      <span>
        <!--百度统计-->
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fcc95332ab242dd5093ad15fa3eecb313' type='text/javascript'%3E%3C/script%3E"));
</script>

      </span>
    </li>
  </ul>
</footer>


    

</div>




      
    <script data-main="/themes/atlas/javascript/main" src="/themes/atlas/javascript/require.js" defer async="true"></script>
    
  </body>
</html>
